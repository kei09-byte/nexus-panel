<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Radiant Flow Field</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    :root {
      --bg: #191919;
    }

    * {
      box-sizing: border-box;
      -webkit-tap-highlight-color: transparent;
    }

    html,
    body {
      margin: 0;
      padding: 0;
      width: 100%;
      height: 100%;
      background: var(--bg);
      display: flex;
      align-items: center;
      justify-content: center;
      overflow: hidden;
      font-family: -apple-system, BlinkMacSystemFont, "SF Pro Display",
        system-ui, sans-serif;
    }

    .flow-container {
      width: 100%;
      max-width: 1100px;   /* Notion の本文幅に近いサイズ */
      height: 220px;       /* 時計の少し上〜下ぐらいの高さ */
      position: relative;
      border-radius: 26px;
      overflow: hidden;
      background: radial-gradient(circle at 50% 0%,
        rgba(0, 224, 255, 0.12),
        rgba(10, 10, 10, 0.96) 60%);
      box-shadow:
        0 18px 45px rgba(0, 0, 0, 0.85),
        0 0 0 1px rgba(255, 255, 255, 0.02);
    }

    canvas {
      width: 100%;
      height: 100%;
      display: block;
    }

    /* 上に薄いグラデーションフィルムを被せて、Notion背景になじませる */
    .film {
      pointer-events: none;
      position: absolute;
      inset: 0;
      background:
        linear-gradient(
          135deg,
          rgba(0, 224, 255, 0.16),
          rgba(23, 37, 84, 0.4),
          rgba(76, 29, 149, 0.32)
        );
      mix-blend-mode: screen;
      opacity: 0.45;
    }

    .grain {
      pointer-events: none;
      position: absolute;
      inset: 0;
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 160 160'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='1.2' numOctaves='2' stitchTiles='noStitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)' opacity='0.35'/%3E%3C/svg%3E");
      mix-blend-mode: soft-light;
      opacity: 0.35;
    }
  </style>
</head>
<body>
  <div class="flow-container">
    <canvas id="flowCanvas"></canvas>
    <div class="film"></div>
    <div class="grain"></div>
  </div>

  <script>
    (function () {
      const canvas = document.getElementById("flowCanvas");
      const ctx = canvas.getContext("2d");

      const dpr = window.devicePixelRatio || 1;
      let width, height, centerY;

      function resize() {
        const rect = canvas.getBoundingClientRect();
        width = rect.width;
        height = rect.height;
        canvas.width = width * dpr;
        canvas.height = height * dpr;
        ctx.setTransform(dpr, 0, 0, dpr, 0, 0);
        centerY = height / 2;
      }

      window.addEventListener("resize", resize);
      resize();

      let t = 0;

      function lerpColor(c1, c2, t) {
        return [
          c1[0] + (c2[0] - c1[0]) * t,
          c1[1] + (c2[1] - c1[1]) * t,
          c1[2] + (c2[2] - c1[2]) * t,
        ];
      }

      function drawLayer(offsetT, ampBase, ampDetail, alphaBase, thickness) {
        const step = 6; // 点と点の間隔（小さいほど細かい）
        const cLeft = [56, 189, 248];   // シアン寄り
        const cMid  = [59, 130, 246];   // ブルー寄り
        const cRight= [147, 51, 234];   // パープル寄り

        for (let x = 0; x <= width; x += step) {
          const nx = x / width;
          const a = nx * Math.PI * 2;

          const base = Math.sin(a * 1.1 + t * 0.7 + offsetT) * ampBase;
          const detail = Math.cos(a * 3.3 - t * 1.4 - offsetT) * ampDetail;
          const y = centerY + base + detail;

          // カラー補間（左→中央→右）
          let col;
          if (nx < 0.5) {
            const tt = nx / 0.5;
            col = lerpColor(cLeft, cMid, tt);
          } else {
            const tt = (nx - 0.5) / 0.5;
            col = lerpColor(cMid, cRight, tt);
          }

          const alpha = alphaBase * (0.6 + 0.4 * Math.sin(t * 0.8 + nx * 5));
          ctx.fillStyle = `rgba(${col[0]}, ${col[1]}, ${col[2]}, ${alpha})`;

          const r = thickness * (0.9 + 0.4 * Math.sin(t * 1.2 + nx * 12 + offsetT));
          ctx.beginPath();
          ctx.arc(x, y, r, 0, Math.PI * 2);
          ctx.fill();
        }
      }

      function render() {
        ctx.clearRect(0, 0, width, height);

        // 背景を少しだけ暗く塗る（残像感は出さずクリーンに）
        ctx.fillStyle = "rgba(12, 12, 12, 1)";
        ctx.fillRect(0, 0, width, height);

        const ampBase = height * 0.20;
        const ampDetail = height * 0.09;

        // 奥のレイヤー（ぼんやり）
        drawLayer(0.0, ampBase * 0.9, ampDetail * 0.7, 0.22, 1.3);

        // 中間レイヤー
        drawLayer(1.2, ampBase * 0.7, ampDetail * 0.9, 0.30, 1.6);

        // 手前レイヤー（少しだけ明るい）
        drawLayer(2.4, ampBase * 0.5, ampDetail * 1.1, 0.38, 1.9);

        t += 0.015; // 速度：ゆっくり流れるくらい
        requestAnimationFrame(render);
      }

      render();
    })();
  </script>
</body>
</html>
